<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>计划任务使用教程 | 悬浮字幕</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="在 Android 上高亮显示直播翻译弹幕为悬浮字幕">
    <link rel="preload" href="/assets/css/0.styles.06da0ae5.css" as="style"><link rel="preload" href="/assets/js/app.47aadde2.js" as="script"><link rel="preload" href="/assets/js/2.f87f6062.js" as="script"><link rel="preload" href="/assets/js/14.7730d457.js" as="script"><link rel="prefetch" href="/assets/js/10.192c4040.js"><link rel="prefetch" href="/assets/js/11.bf5085ae.js"><link rel="prefetch" href="/assets/js/12.8b095cee.js"><link rel="prefetch" href="/assets/js/13.ba82467d.js"><link rel="prefetch" href="/assets/js/15.ad1b739f.js"><link rel="prefetch" href="/assets/js/16.52473345.js"><link rel="prefetch" href="/assets/js/17.6c4ebf61.js"><link rel="prefetch" href="/assets/js/18.cde28da0.js"><link rel="prefetch" href="/assets/js/19.f0e91613.js"><link rel="prefetch" href="/assets/js/20.ad36334c.js"><link rel="prefetch" href="/assets/js/21.1780817a.js"><link rel="prefetch" href="/assets/js/22.106e90ec.js"><link rel="prefetch" href="/assets/js/23.d73d7947.js"><link rel="prefetch" href="/assets/js/24.bf7ea89d.js"><link rel="prefetch" href="/assets/js/25.20adadee.js"><link rel="prefetch" href="/assets/js/3.bc26c65b.js"><link rel="prefetch" href="/assets/js/4.ed332ec4.js"><link rel="prefetch" href="/assets/js/5.f138a364.js"><link rel="prefetch" href="/assets/js/6.620ad76f.js"><link rel="prefetch" href="/assets/js/7.7abfe022.js"><link rel="prefetch" href="/assets/js/8.f329cfd7.js"><link rel="prefetch" href="/assets/js/9.0fe50bda.js">
    <link rel="stylesheet" href="/assets/css/0.styles.06da0ae5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/danmaqua-logo.png" alt="悬浮字幕" class="logo"> <span class="site-name can-hide">悬浮字幕</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/intro.html" class="nav-link">
  介绍
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="功能" class="dropdown-title"><span class="title">功能</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/features/subscription.html" class="nav-link">
  订阅主播
</a></li><li class="dropdown-item"><!----> <a href="/features/danmaku.html" class="nav-link">
  弹幕服务
</a></li><li class="dropdown-item"><!----> <a href="/features/filter.html" class="nav-link">
  弹幕过滤
</a></li><li class="dropdown-item"><!----> <a href="/features/floating.html" class="nav-link">
  悬浮窗
</a></li><li class="dropdown-item"><!----> <a href="/features/history.html" class="nav-link">
  弹幕历史
</a></li><li class="dropdown-item"><!----> <a href="/features/tips.html" class="nav-link">
  小技巧
</a></li></ul></div></div><div class="nav-item"><a href="/download.html" class="nav-link">
  下载
</a></div><div class="nav-item"><a href="/changelogs.html" class="nav-link">
  更新日志
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Bot 版" class="dropdown-title"><span class="title">Bot 版</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/bot/userpage.html" class="nav-link">
  我是观众，如何使用
</a></li><li class="dropdown-item"><!----> <a href="/bot/dev.html" class="nav-link">
  Bot 快速搭建教程
</a></li><li class="dropdown-item"><!----> <a href="/bot/config.html" class="nav-link">
  Bot 配置说明
</a></li><li class="dropdown-item"><!----> <a href="/bot/run_with_docker.html" class="nav-link">
  Docker 部署教程
</a></li><li class="dropdown-item"><!----> <a href="/bot/dmsrc_api.html" class="nav-link">
  弹幕源 API
</a></li><li class="dropdown-item"><!----> <a href="/bot/scheduler_usage.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  计划任务使用教程
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/fython/danmaqua-android" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub 仓库
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/intro.html" class="nav-link">
  介绍
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="功能" class="dropdown-title"><span class="title">功能</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/features/subscription.html" class="nav-link">
  订阅主播
</a></li><li class="dropdown-item"><!----> <a href="/features/danmaku.html" class="nav-link">
  弹幕服务
</a></li><li class="dropdown-item"><!----> <a href="/features/filter.html" class="nav-link">
  弹幕过滤
</a></li><li class="dropdown-item"><!----> <a href="/features/floating.html" class="nav-link">
  悬浮窗
</a></li><li class="dropdown-item"><!----> <a href="/features/history.html" class="nav-link">
  弹幕历史
</a></li><li class="dropdown-item"><!----> <a href="/features/tips.html" class="nav-link">
  小技巧
</a></li></ul></div></div><div class="nav-item"><a href="/download.html" class="nav-link">
  下载
</a></div><div class="nav-item"><a href="/changelogs.html" class="nav-link">
  更新日志
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Bot 版" class="dropdown-title"><span class="title">Bot 版</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/bot/userpage.html" class="nav-link">
  我是观众，如何使用
</a></li><li class="dropdown-item"><!----> <a href="/bot/dev.html" class="nav-link">
  Bot 快速搭建教程
</a></li><li class="dropdown-item"><!----> <a href="/bot/config.html" class="nav-link">
  Bot 配置说明
</a></li><li class="dropdown-item"><!----> <a href="/bot/run_with_docker.html" class="nav-link">
  Docker 部署教程
</a></li><li class="dropdown-item"><!----> <a href="/bot/dmsrc_api.html" class="nav-link">
  弹幕源 API
</a></li><li class="dropdown-item"><!----> <a href="/bot/scheduler_usage.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  计划任务使用教程
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/fython/danmaqua-android" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub 仓库
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="计划任务使用教程"><a href="#计划任务使用教程" class="header-anchor">#</a> 计划任务使用教程</h1> <p>在 Bot v2.1.0 Beta 加入了计划任务功能，方便定时切换连接弹幕房间、发送消息到目标对话。</p> <blockquote><p>你单推的对象总是出现在别人的直播间怎么办？定时切换弹幕房间能够帮你在开播前及时切换到 Ta 活跃的直播间，不错过同传弹幕。</p></blockquote> <h2 id="如何管理计划任务"><a href="#如何管理计划任务" class="header-anchor">#</a> 如何管理计划任务</h2> <p>首先，确认你已经拥有弹幕转发对话（频道）的管理权限，然后在 Bot 对话中使用 <code>/manage_chats</code> 呼出对话管理菜单，选择你要管理的对话，点击 “计划任务” 按钮，进入计划任务管理状态。</p> <p>在计划任务管理状态，你可以使用三种命令管理当前对话的任务，在一个对话中同样的 cron 表达式只能有一种操作：</p> <ul><li><code>add</code>：添加计划任务</li></ul> <p>格式：<code>add [cron 表达式] [操作代码]</code></p> <ul><li><code>del</code>：删除计划任务</li></ul> <p>格式：<code>del [cron 表达式]</code></p> <ul><li><code>clear</code>：清除当前对话的所有计划任务</li></ul> <p>格式：<code>clear</code></p> <h2 id="如何编写-cron-表达式"><a href="#如何编写-cron-表达式" class="header-anchor">#</a> 如何编写 cron 表达式</h2> <p>格式如下：</p> <div class="language- extra-class"><pre class="language-text"><code># ┌────────────── second
# │ ┌──────────── minute
# │ │ ┌────────── hour
# │ │ │ ┌──────── day of month
# │ │ │ │ ┌────── month
# │ │ │ │ │ ┌──── day of week
# │ │ │ │ │ │
# │ │ │ │ │ │
# * * * * * *
</code></pre></div><p>其中：</p> <ul><li><code>second</code>：表示秒数，可以是从0到59之间的任何整数。</li> <li><code>minute</code>：表示分钟，可以是从0到59之间的任何整数。</li> <li><code>hour</code>：表示小时，可以是从0到23之间的任何整数。</li> <li><code>day</code>：表示日期，可以是从1到31之间的任何整数。</li> <li><code>month</code>：表示月份，可以是从1到12之间的任何整数。</li> <li><code>week</code>：表示星期几，可以是从0到7之间的任何整数，这里的0或7代表星期日。</li></ul> <p>在以上各个字段中，还可以使用以下特殊字符：</p> <ul><li>星号 (<code>*</code>) :代表所有可能的值，例如month字段如果是星号，则表示在满足其它字段的制约条件后每月都执行该命令操作。</li> <li>逗号（<code>,</code>）：可以用逗号隔开的值指定一个列表范围，例如 “1,2,5,7,8,9”</li> <li>中杠（<code>-</code>）：可以用整数之间的中杠表示一个整数范围，例如 “2-6” 表示 “2,3,4,5,6”</li> <li>正斜线（<code>/</code>）：可以用正斜线指定时间的间隔频率，例如 “0-23/2” 表示每两小时执行一次。同时正斜线可以和星号一起使用，例如*/10，如果用在minute字段，表示每十分钟执行一次。</li></ul> <h2 id="如何编写操作代码"><a href="#如何编写操作代码" class="header-anchor">#</a> 如何编写操作代码</h2> <p>计划任务只提供了简单的三种操作可以触发：切换房间和弹幕源、发送纯文本到对话、发送 HTML 到对话。</p> <h3 id="切换房间和弹幕源"><a href="#切换房间和弹幕源" class="header-anchor">#</a> 切换房间和弹幕源</h3> <p>操作代码格式：</p> <div class="language- extra-class"><pre class="language-text"><code>set_room [房间号] [弹幕源 ID]
</code></pre></div><p>如果要连接到 <code>bilibili</code> 源的房间 <code>415594</code>，则操作代码为 <code>set_room 415594 bilibili</code>。</p> <p>如果是要每天的 12:00 完成这个任务，则在计划任务管理状态时，发送以下消息完成添加任务：</p> <div class="language- extra-class"><pre class="language-text"><code>add 0 0 12 * * * set_room 415594 bilibili
</code></pre></div><h3 id="发送纯文本到对话"><a href="#发送纯文本到对话" class="header-anchor">#</a> 发送纯文本到对话</h3> <p>操作代码格式：</p> <div class="language- extra-class"><pre class="language-text"><code>send_text [内容]
</code></pre></div><p>对话目标是当前计划任务所在的对话，不可更改，一般用于定时发送消息到同传弹幕转发频道。</p> <p>如果要发送 <code>I'm cute.</code>，则操作代码为 <code>send_text I'm cute.</code></p> <h3 id="发送-html-到对话"><a href="#发送-html-到对话" class="header-anchor">#</a> 发送 HTML 到对话</h3> <p>操作代码格式：</p> <div class="language- extra-class"><pre class="language-text"><code>send_html [HTML 代码]
</code></pre></div><p>对话目标是当前计划任务所在的对话，不可更改，一般用于定时发送消息到同传弹幕转发频道。</p> <p>如果要发送 <code>来试试这个&lt;a herf=&quot;https://danmaqua.github.io&quot;&gt;悬浮字幕 Android 版&lt;/a&gt;</code>，则操作代码为：</p> <div class="language- extra-class"><pre class="language-text"><code>send_html 来试试这个&lt;a herf=&quot;https://danmaqua.github.io&quot;&gt;悬浮字幕 Android 版&lt;/a&gt;
</code></pre></div><h2 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项</h2> <p>由于目前没有对任务执行频率做出限制，身为管理员你应当为 Bot 所做出的行为负责，请不要滥用计划任务。</p> <p>执行结果成功与否都会发送给当前频道的管理员，目前暂无屏蔽执行结果的设置，如果你觉得非常需要，请私信我并暂时关闭 Bot 的消息通知。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/danmaqua/danmaqua.github.io/edit/raw/docs/bot/scheduler_usage.md" target="_blank" rel="noopener noreferrer">帮助我们改善文档</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.47aadde2.js" defer></script><script src="/assets/js/2.f87f6062.js" defer></script><script src="/assets/js/14.7730d457.js" defer></script>
  </body>
</html>
